/**
 * Audio Configuration for Pinyin Chart
 *
 * Defines CDN URLs and audio file paths.
 * Audio files are hotlinked from jsDelivr CDN (GitHub mirror).
 */

// Primary CDN: jsDelivr (fast, global CDN with no rate limits)
export const AUDIO_CDN_BASE = 'https://cdn.jsdelivr.net/gh/davinfifield/mp3-chinese-pinyin-sound@master/mp3';

// Fallback CDN: GitHub raw (slower, may have rate limits)
export const AUDIO_CDN_FALLBACK = 'https://raw.githubusercontent.com/davinfifield/mp3-chinese-pinyin-sound/master/mp3';

// Use TTS for these syllables (known CDN issues)
export const TTS_OVERRIDE_SYLLABLES = new Set([
  'sheng4', // CDN file sounds like tone 1
  'lian4',  // CDN file incorrect
  'ao4',    // CDN file incorrect
  'lv1',    // CDN missing lü syllables
  'lv2',
  'lv3',
  'lv4',
  'nv3',    // CDN missing nü syllables
  'nv4',
]);

// Use TTS for these vocabulary words (known CDN issues)
export const TTS_OVERRIDE_VOCAB = new Set([
  '工人',   // CDN pronunciation incorrect
  '握手',   // CDN pronunciation incorrect
  '热',     // CDN pronunciation incorrect
]);

/**
 * Pinyin to representative Hanzi mapping for TTS
 * Each pinyin base maps to characters for tones 1-4
 * Used when CDN audio is known to be incorrect
 *
 * To add a new syllable:
 * 1. Add the pinyin+tone to TTS_OVERRIDE_SYLLABLES above
 * 2. Add the base pinyin here with representative characters for all 4 tones
 */
export const PINYIN_TO_HANZI: Record<string, [string, string, string, string]> = {
  // Format: [tone1, tone2, tone3, tone4]
  // Confirmed problematic CDN files
  'ao': ['凹', '熬', '袄', '奥'],
  'sheng': ['生', '绳', '省', '剩'],
  'lian': ['连', '连', '脸', '练'],

  // Common syllables (pre-populated for easy addition)
  'a': ['啊', '啊', '啊', '啊'],
  'ai': ['哀', '挨', '矮', '爱'],
  'an': ['安', '安', '俺', '按'],
  'ang': ['肮', '昂', '昂', '盎'],
  'ba': ['八', '拔', '把', '爸'],
  'bai': ['百', '白', '百', '败'],
  'ban': ['班', '般', '板', '办'],
  'bang': ['帮', '旁', '榜', '棒'],
  'bao': ['包', '雹', '宝', '报'],
  'bei': ['杯', '北', '北', '被'],
  'ben': ['奔', '奔', '本', '笨'],
  'bi': ['逼', '鼻', '比', '必'],
  'bian': ['边', '便', '扁', '变'],
  'biao': ['标', '标', '表', '表'],
  'bing': ['冰', '冰', '饼', '病'],
  'bu': ['不', '不', '补', '不'],
  'ca': ['擦', '擦', '擦', '擦'],
  'cai': ['猜', '才', '彩', '菜'],
  'can': ['参', '残', '惨', '灿'],
  'cang': ['仓', '藏', '藏', '藏'],
  'cao': ['操', '曹', '草', '草'],
  'ce': ['册', '侧', '厕', '测'],
  'ci': ['词', '瓷', '此', '次'],
  'cong': ['聪', '从', '从', '从'],
  'cuo': ['搓', '嵯', '撮', '错'], // cuo2: 嵯
  'da': ['搭', '达', '打', '大'],
  'dai': ['呆', '带', '歹', '代'],
  'dan': ['丹', '担', '胆', '但'],
  'dang': ['当', '当', '党', '当'],
  'dao': ['刀', '到', '岛', '到'],
  'de': ['得', '得', '得', '的'],
  'deng': ['灯', '等', '等', '等'],
  'di': ['低', '敌', '底', '地'],
  'dian': ['点', '典', '点', '电'],
  'diao': ['雕', '调', '吊', '掉'],
  'ding': ['丁', '定', '顶', '定'],
  'dong': ['东', '冬', '懂', '动'],
  'dou': ['都', '都', '斗', '豆'],
  'du': ['都', '读', '肚', '度'],
  'dui': ['堆', '对', '对', '对'],
  'dun': ['吨', '敦', '盹', '顿'],
  'duo': ['多', '多', '朵', '夺'],
  'e': ['阿', '额', '恶', '饿'],
  'ei': ['欸', '诶', '诶', '诶'],
  'en': ['恩', '恩', '恩', '恩'],
  'er': ['耳', '儿', '耳', '二'],
  'fa': ['发', '罚', '法', '发'],
  'fan': ['翻', '凡', '反', '饭'],
  'fang': ['方', '房', '访', '放'],
  'fei': ['飞', '肥', '匪', '费'],
  'fen': ['分', '坟', '粉', '份'],
  'feng': ['风', '冯', '讽', '凤'],
  'fo': ['佛', '佛', '佛', '佛'],
  'fu': ['夫', '服', '府', '父'],
  'ga': ['嘎', '嘎', '嘎', '嘎'],
  'gai': ['该', '改', '盖', '概'],
  'gan': ['干', '甘', '感', '干'],
  'gang': ['刚', '岗', '港', '钢'],
  'gao': ['高', '搞', '搞', '告'],
  'ge': ['哥', '歌', '各', '个'],
  'gei': ['给', '给', '给', '给'],
  'gen': ['跟', '根', '跟', '跟'],
  'gong': ['工', '公', '巩', '共'],
  'gou': ['沟', '狗', '够', '够'],
  'gu': ['姑', '古', '鼓', '故'],
  'gua': ['瓜', '刮', '寡', '挂'],
  'guai': ['乖', '拐', '怪', '怪'],
  'guan': ['关', '官', '管', '惯'],
  'guang': ['光', '广', '广', '逛'],
  'gui': ['归', '龟', '鬼', '贵'],
  'gun': ['滚', '棍', '滚', '棍'],
  'guo': ['锅', '国', '果', '过'],
  'ha': ['哈', '哈', '哈', '哈'],
  'hai': ['海', '还', '海', '害'],
  'han': ['寒', '含', '喊', '汉'],
  'hang': ['航', '行', '行', '巷'],
  'hao': ['好', '毫', '好', '号'],
  'he': ['喝', '何', '和', '和'],
  'hei': ['黑', '黑', '黑', '黑'],
  'hen': ['很', '恨', '狠', '恨'],
  'heng': ['哼', '横', '横', '横'],
  'hong': ['红', '红', '哄', '红'],
  'hou': ['猴', '侯', '后', '后'],
  'hu': ['呼', '胡', '虎', '户'],
  'hua': ['花', '华', '化', '话'],
  'huai': ['怀', '坏', '坏', '坏'],
  'huan': ['欢', '还', '缓', '换'],
  'huang': ['荒', '黄', '谎', '晃'],
  'hui': ['灰', '回', '悔', '会'],
  'hun': ['昏', '魂', '混', '混'],
  'huo': ['活', '活', '火', '或'],
  'ji': ['机', '及', '几', '记'],
  'jia': ['家', '加', '假', '价'],
  'jian': ['间', '件', '减', '见'],
  'jiang': ['江', '将', '讲', '将'],
  'jiao': ['教', '交', '脚', '叫'],
  'jie': ['接', '节', '姐', '界'],
  'jin': ['今', '金', '紧', '进'],
  'jing': ['京', '经', '警', '静'],
  'jiu': ['九', '就', '久', '就'],
  'ju': ['居', '局', '举', '句'],
  'juan': ['捐', '卷', '卷', '卷'],
  'jue': ['觉', '决', '觉', '绝'],
  'jun': ['军', '君', '俊', '俊'],
  'ka': ['卡', '卡', '卡', '卡'],
  'kai': ['开', '开', '凯', '开'],
  'kan': ['看', '看', '砍', '看'],
  'kang': ['康', '扛', '抗', '抗'],
  'kao': ['考', '烤', '考', '靠'],
  'ke': ['科', '壳', '可', '课'],
  'ken': ['肯', '肯', '肯', '肯'],
  'kong': ['空', '空', '孔', '控'],
  'kou': ['口', '口', '口', '扣'],
  'ku': ['哭', '苦', '苦', '库'],
  'kua': ['夸', '跨', '垮', '跨'],
  'kuai': ['快', '快', '快', '快'],
  'kuan': ['宽', '款', '款', '款'],
  'kuang': ['狂', '矿', '况', '况'],
  'kun': ['昆', '困', '困', '困'],
  'kuo': ['阔', '括', '扩', '阔'],
  'la': ['拉', '拉', '喇', '辣'],
  'lai': ['来', '来', '来', '赖'],
  'lan': ['兰', '蓝', '懒', '烂'],
  'lang': ['郎', '狼', '朗', '浪'],
  'lao': ['老', '劳', '老', '老'],
  'le': ['乐', '了', '了', '乐'],
  'lei': ['雷', '累', '累', '类'],
  'leng': ['冷', '冷', '冷', '冷'],
  'li': ['离', '李', '里', '力'],
  'lia': ['俩', '俩', '俩', '俩'],
  'liang': ['凉', '良', '两', '亮'],
  'liao': ['聊', '辽', '了', '料'],
  'lie': ['列', '烈', '裂', '列'],
  'lin': ['林', '临', '林', '林'],
  'ling': ['灵', '零', '领', '令'],
  'liu': ['六', '流', '柳', '六'],
  'long': ['龙', '笼', '拢', '弄'],
  'lou': ['楼', '漏', '楼', '漏'],
  'lu': ['路', '炉', '路', '路'],
  'lv': ['律', '绿', '旅', '律'],
  'luan': ['乱', '乱', '乱', '乱'],
  'lun': ['抡', '轮', '仑', '论'], // lun1: 抡 (swing)
  'luo': ['罗', '落', '落', '落'],
  'ma': ['妈', '麻', '马', '骂'],
  'mai': ['买', '麦', '买', '卖'],
  'man': ['满', '慢', '满', '慢'],
  'mang': ['忙', '芒', '莽', '忙'],
  'mao': ['毛', '猫', '毛', '冒'],
  'me': ['么', '么', '么', '么'],
  'mei': ['没', '美', '美', '没'],
  'men': ['门', '闷', '闷', '闷'],
  'meng': ['蒙', '梦', '梦', '梦'],
  'mi': ['米', '迷', '米', '密'],
  'mian': ['面', '棉', '免', '面'],
  'miao': ['苗', '描', '秒', '妙'],
  'min': ['民', '敏', '民', '敏'],
  'ming': ['名', '明', '命', '命'],
  'mo': ['摸', '魔', '抹', '末'],
  'mou': ['谋', '某', '某', '某'],
  'mu': ['母', '木', '母', '目'],
  'na': ['拿', '那', '哪', '那'],
  'nai': ['奶', '耐', '奶', '耐'],
  'nan': ['南', '男', '难', '难'],
  'nang': ['囊', '囊', '囊', '囊'],
  'nao': ['脑', '闹', '脑', '闹'],
  'ne': ['呢', '呢', '呢', '呢'],
  'nei': ['内', '内', '内', '内'],
  'nen': ['嫩', '嫩', '嫩', '嫩'],
  'ni': ['你', '泥', '你', '逆'],
  'nian': ['年', '念', '年', '念'],
  'niang': ['娘', '酿', '娘', '酿'],
  'niao': ['鸟', '尿', '鸟', '尿'],
  'nin': ['您', '您', '您', '您'],
  'ning': ['宁', '宁', '拧', '宁'],
  'niu': ['牛', '纽', '扭', '牛'],
  'nong': ['农', '浓', '弄', '弄'],
  'nu': ['奴', '努', '怒', '怒'],
  'nv': ['女', '女', '女', '女'],
  'nuan': ['暖', '暖', '暖', '暖'],
  'nuo': ['诺', '挪', '懦', '诺'],
  'ou': ['欧', '偶', '呕', '偶'],
  'pa': ['怕', '爬', '怕', '怕'],
  'pai': ['拍', '排', '派', '派'],
  'pan': ['盘', '盼', '判', '盼'],
  'pang': ['旁', '胖', '胖', '胖'],
  'pao': ['跑', '炮', '跑', '炮'],
  'pei': ['陪', '培', '配', '配'],
  'pen': ['盆', '喷', '盆', '喷'],
  'peng': ['朋', '碰', '捧', '碰'],
  'pi': ['皮', '批', '匹', '屁'],
  'pian': ['片', '骗', '偏', '骗'],
  'piao': ['票', '漂', '票', '漂'],
  'pin': ['品', '贫', '品', '聘'],
  'ping': ['平', '评', '瓶', '平'],
  'po': ['破', '婆', '破', '破'],
  'pu': ['普', '铺', '朴', '普'],
  'qi': ['七', '其', '起', '气'],
  'qia': ['恰', '掐', '恰', '恰'],
  'qian': ['前', '钱', '浅', '欠'],
  'qiang': ['枪', '强', '抢', '强'],
  'qiao': ['桥', '敲', '巧', '桥'],
  'qie': ['切', '且', '切', '切'],
  'qin': ['亲', '琴', '亲', '亲'],
  'qing': ['青', '情', '请', '庆'],
  'qiong': ['穷', '琼', '穷', '穷'],
  'qiu': ['秋', '求', '球', '秋'],
  'qu': ['去', '区', '取', '去'],
  'quan': ['全', '权', '全', '劝'],
  'que': ['却', '缺', '确', '却'],
  'qun': ['群', '裙', '群', '群'],
  'ran': ['然', '染', '然', '染'],
  'rang': ['让', '嚷', '让', '让'],
  'rao': ['绕', '饶', '绕', '绕'],
  're': ['热', '热', '热', '热'],
  'ren': ['人', '认', '忍', '任'],
  'reng': ['仍', '扔', '仍', '仍'],
  'ri': ['日', '日', '日', '日'],
  'rong': ['容', '荣', '溶', '融'],
  'rou': ['肉', '柔', '肉', '肉'],
  'ru': ['如', '入', '乳', '如'],
  'ruan': ['软', '软', '软', '软'],
  'rui': ['瑞', '锐', '瑞', '锐'],
  'run': ['润', '润', '润', '润'],
  'ruo': ['若', '弱', '若', '弱'],
  'sa': ['撒', '洒', '撒', '撒'],
  'sai': ['赛', '塞', '赛', '赛'],
  'san': ['三', '伞', '散', '散'],
  'sang': ['桑', '丧', '嗓', '丧'],
  'sao': ['扫', '骚', '嫂', '扫'],
  'se': ['色', '涩', '色', '色'],
  'sen': ['森', '森', '森', '森'],
  'sha': ['沙', '杀', '傻', '沙'],
  'shai': ['晒', '筛', '晒', '晒'],
  'shan': ['山', '善', '闪', '扇'],
  'shang': ['上', '商', '赏', '上'],
  'shao': ['少', '烧', '少', '绍'],
  'she': ['蛇', '舌', '舍', '社'],
  'shen': ['身', '深', '沈', '甚'],
  'shi': ['诗', '十', '使', '是'],
  'shou': ['手', '受', '首', '瘦'],
  'shu': ['书', '熟', '鼠', '数'],
  'shua': ['刷', '刷', '耍', '刷'],
  'shuai': ['帅', '摔', '甩', '帅'],
  'shuan': ['栓', '栓', '栓', '栓'],
  'shuang': ['双', '爽', '双', '爽'],
  'shui': ['水', '谁', '水', '睡'],
  'shun': ['顺', '顺', '顺', '顺'],
  'shuo': ['说', '说', '说', '说'],
  'si': ['思', '死', '死', '四'],
  'song': ['松', '送', '宋', '送'],
  'sou': ['搜', '嗽', '嗽', '嗽'],
  'su': ['苏', '俗', '素', '速'],
  'suan': ['酸', '算', '蒜', '算'],
  'sui': ['岁', '随', '岁', '碎'],
  'sun': ['孙', '损', '笋', '损'],
  'suo': ['所', '锁', '所', '锁'],
  'ta': ['他', '塔', '他', '踏'],
  'tai': ['台', '抬', '太', '态'],
  'tan': ['谈', '坦', '坦', '炭'],
  'tang': ['汤', '糖', '躺', '烫'],
  'tao': ['桃', '逃', '讨', '套'],
  'te': ['特', '特', '特', '特'],
  'teng': ['疼', '腾', '藤', '疼'],
  'ti': ['提', '题', '体', '替'],
  'tian': ['天', '甜', '舔', '田'],
  'tiao': ['条', '调', '跳', '跳'],
  'tie': ['铁', '贴', '铁', '帖'],
  'ting': ['听', '停', '挺', '厅'],
  'tong': ['同', '通', '桶', '痛'],
  'tou': ['头', '偷', '投', '透'],
  'tu': ['图', '突', '土', '兔'],
  'tuan': ['团', '团', '团', '团'],
  'tui': ['推', '退', '腿', '退'],
  'tun': ['吞', '屯', '臀', '吞'],
  'tuo': ['脱', '拖', '妥', '拓'],
  'wa': ['挖', '娃', '瓦', '袜'],
  'wai': ['外', '歪', '外', '外'],
  'wan': ['完', '玩', '晚', '万'],
  'wang': ['王', '忘', '网', '望'],
  'wei': ['为', '围', '尾', '为'],
  'wen': ['文', '问', '吻', '问'],
  'wo': ['我', '窝', '我', '握'],
  'wu': ['五', '无', '午', '物'],
  'xi': ['西', '习', '洗', '细'],
  'xia': ['下', '虾', '下', '夏'],
  'xian': ['先', '现', '险', '线'],
  'xiang': ['想', '相', '想', '向'],
  'xiao': ['小', '笑', '校', '笑'],
  'xie': ['写', '鞋', '些', '谢'],
  'xin': ['心', '新', '信', '信'],
  'xing': ['行', '星', '醒', '性'],
  'xiong': ['兄', '雄', '熊', '凶'],
  'xiu': ['修', '休', '秀', '袖'],
  'xu': ['需', '许', '许', '续'],
  'xuan': ['选', '悬', '选', '旋'],
  'xue': ['学', '雪', '血', '穴'],
  'xun': ['寻', '训', '迅', '讯'],
  'ya': ['呀', '牙', '雅', '压'],
  'yan': ['言', '眼', '演', '验'],
  'yang': ['样', '羊', '养', '样'],
  'yao': ['要', '药', '要', '要'],
  'ye': ['也', '叶', '夜', '业'],
  'yi': ['一', '以', '已', '意'],
  'yin': ['因', '音', '引', '印'],
  'ying': ['英', '应', '影', '应'],
  'yo': ['哟', '哟', '哟', '哟'],
  'yong': ['用', '永', '勇', '用'],
  'you': ['有', '由', '友', '又'],
  'yu': ['于', '鱼', '雨', '与'],
  'yuan': ['元', '原', '远', '院'],
  'yue': ['月', '约', '越', '乐'],
  'yun': ['云', '运', '允', '运'],
  'za': ['杂', '咋', '咋', '杂'],
  'zai': ['在', '再', '载', '在'],
  'zan': ['咱', '暂', '攒', '赞'],
  'zang': ['脏', '葬', '脏', '葬'],
  'zao': ['早', '糟', '澡', '造'],
  'ze': ['则', '责', '择', '则'],
  'zei': ['贼', '贼', '贼', '贼'],
  'zen': ['怎', '怎', '怎', '怎'],
  'zeng': ['增', '曾', '增', '赠'],
  'zha': ['炸', '扎', '炸', '炸'],
  'zhai': ['摘', '宅', '窄', '债'],
  'zhan': ['站', '占', '展', '战'],
  'zhang': ['张', '长', '掌', '丈'],
  'zhao': ['找', '着', '招', '照'],
  'zhe': ['这', '着', '者', '这'],
  'zhen': ['真', '针', '枕', '阵'],
  'zheng': ['正', '争', '整', '证'],
  'zhi': ['知', '直', '纸', '至'],
  'zhong': ['中', '种', '种', '重'],
  'zhou': ['周', '州', '肘', '昼'],
  'zhu': ['主', '住', '煮', '注'],
  'zhua': ['抓', '抓', '爪', '抓'],
  'zhuai': ['拽', '拽', '拽', '拽'],
  'zhuan': ['专', '转', '转', '赚'],
  'zhuang': ['装', '撞', '壮', '状'],
  'zhui': ['追', '坠', '追', '坠'],
  'zhun': ['准', '准', '准', '准'],
  'zhuo': ['桌', '捉', '卓', '着'],
  'zi': ['资', '字', '子', '自'],
  'zong': ['总', '宗', '总', '纵'],
  'zou': ['走', '邹', '走', '奏'],
  'zu': ['组', '足', '祖', '族'],
  'zuan': ['钻', '钻', '钻', '钻'],
  'zui': ['最', '罪', '醉', '最'],
  'zun': ['尊', '遵', '尊', '遵'],
  'zuo': ['左', '做', '坐', '作'],
};

// Vocabulary audio CDN: audio-cmn project (CC-BY-SA licensed HSK vocabulary)
// Uses Chinese characters (hanzi) as filenames
export const VOCAB_AUDIO_CDN = 'https://raw.githubusercontent.com/hugolpz/audio-cmn/master/64k/hsk';

/**
 * Get the audio URL for a given pinyin syllable with tone
 * @param pinyin - Pinyin syllable with tone number (e.g., "ma1", "zhang4")
 * @returns Full URL to the audio file
 */
export function getAudioUrl(pinyin: string, useFallback = false): string {
  const base = useFallback ? AUDIO_CDN_FALLBACK : AUDIO_CDN_BASE;
  return `${base}/${pinyin}.mp3`;
}

/**
 * Get the vocabulary audio URL for a given Chinese word (hanzi)
 * @param hanzi - Chinese characters (e.g., "你好", "学生")
 * @returns Full URL to the audio file
 */
export function getVocabAudioUrl(hanzi: string): string {
  return `${VOCAB_AUDIO_CDN}/cmn-${hanzi}.mp3`;
}

/**
 * Preload strategy configuration
 */
export const AUDIO_CONFIG = {
  // Maximum number of audio files to keep in memory cache
  maxCacheSize: 300,

  // Common syllables to preload (from HSK 1-2 frequency)
  commonSyllables: [
    'de5', 'shi4', 'yi1', 'bu4', 'wo3', 'ni3', 'ta1', 'le5', 'men5',
    'zhe4', 'you3', 'ge4', 'zai4', 'bu2', 'hao3', 'ren2', 'shang4',
    'lai2', 'dao4', 'xia4', 'zi5', 'hui4', 'guo2', 'shuo1', 'kan4',
    'qu4', 'neng2', 'dou1', 'mei2', 'xiang3', 'yao4', 'dui4', 'yin1',
    'wei4', 'jian4', 'tai4', 'ji3', 'jiu4', 'gong1', 'zuo4', 'tian1',
    'jia1', 'wen4', 'ma5', 'ji4', 'ming2', 'xian4', 'zhong1', 'hou4'
  ],

  // Enable audio preloading
  enablePreload: true,

  // Volume settings
  defaultVolume: 0.7,
  minVolume: 0.0,
  maxVolume: 1.0
} as const;
